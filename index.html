<!DOCTYPE html>
<!-- Horizontal Scrolling Trick from http://css-tricks.com/examples/HorzScrolling/ -->
<html>
	<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="UTF-8">
	
	<title>Digital Narrative</title>
	
	<link rel="stylesheet" href="/css/styles.css">
	<link rel="stylesheet" href="/lib/vegas/jquery.vegas.min.css">
	
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore-min.js"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore-min.map"></script> -->

	<script src="/lib/jquery.mousewheel.js"></script>
	<script src="/lib/vegas/jquery.vegas.min.js"></script>
	<script src="/js/content.js"></script>
    <script src="/js/story.js"></script>
</head>

<body>
	<div id="y"></div>

	<h1>Walking the Border</h1>

    <div id="modal">
        <div class="back"><a onclick="hideModal();">Back to Story</a></div>
        <div class="content"></div>
    </div>

	<div id="page-wrap"><table cellspacing="30"><tbody>
		<tr id="posts"></tr>
	</tbody></table></div>

	<script>

    console.log(story);

	$(function(){
		// Map scroll to horizontal
		$("body, html").mousewheel(function(event, delta) {
			this.scrollLeft -= (delta * 30);
			event.preventDefault();
		});   
	});

	/******************************
	    Populate Initial Content
	 ******************************/

	renderSections();

	function renderSections(){
		var acc = _.reduce(sections, function(memo, section){
			return memo + '<td><div class="post">' + renderSentences(section) + "</div></td>";
		}, 0);

		$("#posts").html(acc);
	}

	function renderSentences(section){
		var acc = "";

		_.each(idList(section.id, section.sentences), function(id){
			var sentence = _.findWhere(sentences, {id : id});
			acc += '<span class="highlight ' + sentence.link + '">' + sentence.sentence + "</span> ";
		})

		return "<p>" + acc + "</p>";;
	}

	function idList(prefix, count){
		var ids = [];

		for (var i = 1; i <= count; i++) {

			// Generate zeros
			var zeros = null;
			if (i < 10) zeros = "00";
			if (i >= 10) zeros = "0"

			ids.push(prefix + zeros + i);
		};

		return ids;
	}

	/******************************
	       Load Sub-Sections
	 ******************************/

    showModal("001");

    function showModal(id){
        xhr_GET(id + ".html", function(content){

            // Callback: populate & fade in modal
            $("#modal .content").html(content).fadeIn();
        })
    }

    function hideModal(){
        $("#modal").fadeOut();
    }

    function xhr_GET(url, next){
        var xhr= new XMLHttpRequest();

        xhr.open('GET', 'links/' + url, true);

        xhr.onreadystatechange= function() {
            if (this.readyState!==4) return;
            if (this.status!==200) return; // or whatever error handling you want

            next(this.responseText);
        };

        xhr.send();
    }

	/******************************
	        Background
	 ******************************/

	$.vegas.defaults = {
	  background: {
	    src:         null, // defined by Css
	    align:       'center',
	    valign:      'center',
	    fade:        1000,
	    loading:     true,
	    load:        function(){},
	    complete:    function(){}
	  },
	  slideshow: {
	    step:        0,
	    delay:       5000,
	    backgrounds: [],
	    preload:     false,
	    walk:        function(){}
	  },
	  overlay: {
	    src:         '/lib/vegas/overlays/13.png', // defined by Css 
	    opacity:     1,  // defined by Css 
	  }
	}

	// $(function() {
	//   $.vegas({
	//     src:'http://upload.wikimedia.org/wikipedia/commons/3/3c/Amargosa_desert.jpg'
	//   })
	// });

	</script>
 </body></html>